---
layout: index
index: true
title: 'å°è£… BJBN 3.0é€šç”¨åœ°å›¾ç»„ä»¶'
cover: '/images/posts/bjbn-map/1.png'
description: 'ç¬¬ä¸€æ¬¡å‚åŠ å·¥ä½œç»™å…¬å¸å°è£…çš„ç¬¬ä¸€ä¸ªæ’ä»¶bjbn-map-containerï¼Œä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®'
category: map
tags:
    - name: Map
      icon: mdi:map-check
      color: #000000
      url: https://www.geomapapp.org/
    - name: GitHub
      icon: ri:github-fill
      color: #000000
      url: https://github.com/359Steve/bjbn-map.git
date: 2025-08-20
---

---

> ç¬¬ä¸€æ¬¡åšå¼€æºæ’ä»¶ï¼Œå¿ƒç†ä¸Šä¼šè§‰å¾—â€œåº”è¯¥å¾ˆéš¾â€ï¼Œä½†çœŸæ­£æ‹†å¼€æ¥çœ‹ï¼Œå…¶å®å°±æ˜¯ä¸æ–­è§£å†³å…·ä½“é—®é¢˜çš„è¿‡ç¨‹ã€‚

> æ„Ÿè°¢è°¢ç»„é•¿åœ¨è®¾è®¡å’Œç»†èŠ‚ä¸Šçš„è¡¥å……ä¸å®Œå–„ï¼Œä¸‹é¢å°±è®°å½•ä¸€ä¸‹**BJBN 3.0 é€šç”¨åœ°å›¾ç»„ä»¶** ä» 0 åˆ° 1 çš„å°è£…è¿‡ç¨‹ã€‚

---

## å°è£…çš„èƒŒæ™¯ä¸åŠ¨æœº

åœ¨å…¬å¸é¡¹ç›®ä¸­ï¼Œ**åœ°å›¾å‡ ä¹æ˜¯æ¯ä¸ªæ ¸å¿ƒé¡µé¢çš„åŸºç¡€æ¨¡å—**ã€‚è™½ç„¶åº•å±‚åœ°å›¾èµ„æºå’Œé…ç½®æ˜¯ç»Ÿä¸€æä¾›çš„ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ¯ä¸ªé¡µé¢éƒ½éœ€è¦é‡å¤åšä»¥ä¸‹äº‹æƒ…ï¼š

- æ‰‹åŠ¨å¼•å…¥åœ°å›¾ JS èµ„æº

- åˆå§‹åŒ–åœ°å›¾å®ä¾‹

- è¯»å–å¹¶åˆå¹¶é…ç½®

- ç»‘å®šå®¹å™¨å¹¶æ¸²æŸ“

- å¤„ç†é”€æ¯ä¸é‡æ–°åŠ è½½

è¿™äº›æ­¥éª¤åœ¨ä¸åŒé¡µé¢ä¸­é«˜åº¦é‡å¤ï¼Œä¸ä»…å¼€å‘æˆæœ¬é«˜ï¼Œè€Œä¸”ä¸€æ—¦åœ°å›¾ SDK æˆ–åˆå§‹åŒ–é€»è¾‘å‘ç”Ÿå˜åŠ¨ï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿä¼šæˆå€å¢åŠ ã€‚äºæ˜¯æˆ‘å¼€å§‹æ€è€ƒï¼š

> **èƒ½ä¸èƒ½æŠŠâ€œåŠ è½½ + åˆå§‹åŒ– + æ¸²æŸ“â€è¿™ä¸€æ•´å¥—æµç¨‹å°è£…æˆä¸€ä¸ªç»„ä»¶ï¼Œè®©ä¸šåŠ¡é¡µé¢åªå…³å¿ƒâ€œæˆ‘æƒ³ç”¨ä»€ä¹ˆåœ°å›¾â€ï¼Ÿ**

è¿™ä¸ªæƒ³æ³•ï¼Œä¾¿æ˜¯ MapContainer çš„èµ·ç‚¹ã€‚

---

## æ¸²æŸ“åœ°å›¾

### è®¾è®¡ç›®æ ‡

ç¬¬ä¸€ç‰ˆçš„ç›®æ ‡éå¸¸å…‹åˆ¶ï¼Œåªè§£å†³[ã€Œåœ°å›¾èƒ½ä¸èƒ½å¿«é€Ÿæ¸²æŸ“å‡ºæ¥ã€]è¿™ä¸ªé—®é¢˜ã€‚ä¸è€ƒè™‘åˆ‡æ¢ã€ä¸è€ƒè™‘çŠ¶æ€ã€ä¸è€ƒè™‘å¤æ‚äº¤äº’ã€‚ç»„ä»¶å¯¹å¤–åªæš´éœ²æœ€å°å¿…è¦å‚æ•°ï¼Œå®¹å™¨ IDã€å®½é«˜ã€åœ°å›¾é…ç½®ã€‚

### æ ¸å¿ƒæ€è·¯

1. æŒ‰éœ€åŠ è½½åœ°å›¾ SDK

2. SDK åŠ è½½å®Œæˆåï¼Œé€šè¿‡å®˜æ–¹å·¥å‚æ–¹æ³•åˆå§‹åŒ–åœ°å›¾

3. å°†åœ°å›¾å®ä¾‹é€šè¿‡ `expose` æš´éœ²ç»™å¤–éƒ¨

è¿™ç‰ˆç»„ä»¶çš„å­˜åœ¨æ„ä¹‰åªæœ‰ä¸€ä¸ª,**è®©é¡µé¢åªå†™ä¸€è¡Œç»„ä»¶ï¼Œå°±èƒ½çœ‹åˆ°åœ°å›¾**ã€‚ä»ç»“æœæ¥çœ‹ï¼Œå®ƒç¡®å®è¾¾æˆäº†è¿™ä¸ªç›®çš„ï¼Œä½†å¾ˆå¿«é—®é¢˜ä¹Ÿæš´éœ²å‡ºæ¥äº†ã€‚

---

## é—®é¢˜å‡ºç°

éšç€é¡¹ç›®æ¨è¿›ï¼Œåœ°å›¾ç›¸å…³çš„éœ€æ±‚é€æ¸å¤æ‚ï¼š

- åŒä¸€ä¸ªé¡µé¢éœ€è¦åœ¨å¤šå¥—åœ°å›¾é…ç½®ä¹‹é—´åˆ‡æ¢

- åˆ‡æ¢åœ°å›¾æ—¶ï¼Œæ—§å®ä¾‹éœ€è¦è¢«æ­£ç¡®é”€æ¯

- åœ°å›¾ç¼©æ”¾ã€ä¸­å¿ƒç‚¹ã€è§†è§’ç­‰çŠ¶æ€éœ€è¦å¯æ§

- åœ°å›¾å¯¹è±¡è¦èƒ½è¢«ä¸šåŠ¡å·¥å…·ï¼ˆç»˜åˆ¶ã€ç¼–è¾‘ã€å›æ”¾ï¼‰å¤ç”¨

å¦‚æœç»§ç»­åœ¨ä¸šåŠ¡é¡µé¢é‡Œâ€œè¡¥é€»è¾‘â€ï¼Œé‚£æœ€åˆå°è£…ç»„ä»¶çš„æ„ä¹‰å°±ä¸å­˜åœ¨äº†ã€‚äºæ˜¯ï¼Œç»„ä»¶å¼€å§‹è¿›å…¥ **ç¬¬äºŒé˜¶æ®µè¿›åŒ–**ã€‚

---

## å¼•å…¥â€œåœ°å›¾åˆ‡æ¢â€çš„èƒ½åŠ›

### ä¸ºä»€ä¹ˆé€‰æ‹©ç»„ä»¶å†…éƒ¨åˆ‡æ¢

ä¸€å¼€å§‹æˆ‘è€ƒè™‘è¿‡ï¼šç”±çˆ¶ç»„ä»¶å®Œå…¨æ§åˆ¶åœ°å›¾é”€æ¯ä¸é‡å»ºï¼Œä½†å¾ˆå¿«å‘ç°ï¼Œè¿™ä¼šè®©çˆ¶ç»„ä»¶æ‰¿æ‹…å¤§é‡ä¸åœ°å›¾ SDK å¼ºè€¦åˆçš„é€»è¾‘ã€‚æœ€ç»ˆå†³å®šï¼šåœ°å›¾çš„ç”Ÿå‘½å‘¨æœŸï¼Œåº”è¯¥å®Œå…¨ç”± MapContainer è´Ÿè´£ã€‚ä¸šåŠ¡å±‚åªéœ€è¦å‘Šè¯‰æˆ‘ï¼šå½“å‰é€‰ä¸­çš„æ˜¯å“ªä¸€å¥—åœ°å›¾é…ç½®ã€‚

### mapConfigs + currentMapConfig

ç»„ä»¶å¼€å§‹æ¥æ”¶ä¸¤ç±»é…ç½®ï¼š

- mapConfigsï¼šæ‰€æœ‰å¯é€‰åœ°å›¾çš„é›†åˆ

- currentMapConfigï¼šå½“å‰æ­£åœ¨ä½¿ç”¨çš„åœ°å›¾

é€šè¿‡ `v-model`ï¼ˆ`update:currentMapConfig`ï¼‰ï¼Œå®ç°**å—æ§åˆ‡æ¢**ã€‚

å½“ `currentMapConfig` å˜åŒ–æ—¶ï¼š

1. æ¸…ç©ºæ—§åœ°å›¾ DOM

2. å¸è½½æ—§åœ°å›¾å®ä¾‹

3. é‡æ–°åŠ è½½ JS

4. åˆå§‹åŒ–æ–°åœ°å›¾

è¿™ä¸€æ­¥ï¼Œæ­£å¼è®©ç»„ä»¶ä»â€œå±•ç¤ºå‹ç»„ä»¶â€è¿›åŒ–æˆäº†â€œé€»è¾‘å‹ç»„ä»¶â€ã€‚

---

## åœ°å›¾ç”Ÿå‘½å‘¨æœŸç®¡ç†

åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€ä¸ªå¾ˆå…³é”®çš„ç‚¹æ˜¯ï¼š

> **åœ°å›¾å¦‚æœä¸å½»åº•æ¸…ç†ï¼Œå°±ä¸€å®šä¼šå‡ºé—®é¢˜ã€‚**

**reset çš„å¿…è¦æ€§**

åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘å•ç‹¬æŠ½å‡ºäº† reset æ–¹æ³•ï¼Œç”¨æ¥åšå‡ ä»¶äº‹ï¼š

- æ¸…ç©ºåœ°å›¾å®ä¾‹å¼•ç”¨

- æ¸…ç©ºå†…éƒ¨å·¥å…·ï¼ˆdraw / edit / playback ç­‰ï¼‰

- æ¸…ç©ºå®¹å™¨ DOMï¼Œé¿å…é‡å¤æ¸²æŸ“

è¿™ä¸€å±‚â€œå…œåº•â€ï¼Œæå¤§é™ä½äº†åˆ‡æ¢åœ°å›¾æ—¶çš„å¼‚å¸¸æ¦‚ç‡ã€‚

**resetMapState**

é™¤äº†é”€æ¯ï¼Œè¿˜æœ‰ä¸€ç§æ›´å¸¸è§çš„éœ€æ±‚ï¼šå›åˆ°ã€Œåˆå§‹è§†è§’ã€ã€‚å› æ­¤æˆ‘åˆå°è£…äº† resetMapStateï¼š

- é‡ç½® zoom

- é‡ç½® center

- é‡ç½® bearing

- é‡ç½® bounds

å¹¶ä¸”ç›´æ¥åŸºäº `currentMapConfig.config`ï¼Œä¿è¯é…ç½®å³çŠ¶æ€æºã€‚

---

## å¯¹å¤–èƒ½åŠ›æš´éœ²

ä¸€ä¸ªç»„ä»¶å¦‚æœâ€œè¿‡åº¦å°è£…â€ï¼Œåè€Œä¼šé™åˆ¶ä¸šåŠ¡ã€‚æ‰€ä»¥åœ¨è®¾è®¡æ—¶ï¼Œæˆ‘ä¿ç•™äº†ä¸€ä¸ªåŸåˆ™ï¼š

> **æ ¸å¿ƒæµç¨‹æˆ‘æ¥ç®¡ï¼Œèƒ½åŠ›ä½ å¯ä»¥éšæ—¶æ‹¿èµ°ã€‚**

### expose çš„å†…å®¹

- é€šè¿‡ exposeï¼Œå¯¹å¤–æä¾›ï¼š

- mapObjï¼ˆåœ°å›¾å®ä¾‹ï¼‰

- bnmapï¼ˆåº•å±‚åŸå§‹å®ä¾‹ï¼‰

- resetMapState

- draw / edit / playback ç­‰æ‰©å±•èƒ½åŠ›

---

## BJBN 3.0 é€šç”¨åœ°å›¾ç»„ä»¶

å›è¿‡å¤´çœ‹æ•´ä¸ªè¿‡ç¨‹ï¼Œå…¶å®å¹¶ä¸æ˜¯â€œä¸€æ¬¡æ€§è®¾è®¡å‡ºå®Œç¾æ¶æ„â€ï¼Œè€Œæ˜¯ï¼š

1. **å…ˆè§£å†³æœ€ç—›çš„é—®é¢˜**

2. å†éšç€çœŸå®éœ€æ±‚ä¸æ–­è°ƒæ•´è¾¹ç•Œ

3. æŠŠâ€œä¸è¯¥å‡ºç°åœ¨ä¸šåŠ¡å±‚çš„é€»è¾‘â€é€æ­¥æ”¶å›æ¥

ç°åœ¨çš„ `bjbn-map-container` èƒ½åŠ è½½ã€èƒ½åˆ‡æ¢ã€èƒ½é‡ç½®ã€èƒ½æ‰©å±•ã€‚å®ƒä¸å¤æ‚ï¼Œä½†è¶³å¤Ÿç¨³å®šï¼Œä¹Ÿè¶³å¤Ÿå…‹åˆ¶ã€‚

---

## ä¸€äº›ä¸ªäººæ„Ÿå—

ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¸å¿…è¿½æ±‚â€œæ¶æ„å®Œç¾â€ï¼ŒçœŸå®ä¸šåŠ¡ï¼Œæ˜¯æœ€å¥½çš„è®¾è®¡æ–‡æ¡£ï¼Œå°è£…çš„æœ¬è´¨ä¸æ˜¯éšè—ï¼Œè€Œæ˜¯åˆ†å±‚ï¼Œå¸Œæœ›è¿™ç¯‡è®°å½•ï¼Œèƒ½ç»™æ­£åœ¨åšç»„ä»¶å°è£…çš„ä½ ä¸€ç‚¹å‚è€ƒã€‚å¦‚æœä½ ä¹Ÿåœ¨åšåœ°å›¾ç›¸å…³çš„å°è£…ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµğŸ‘‹

---

::: details

```js
import { ElSelect, ElOption } from 'element-plus';
import {
	defineComponent,
	h,
	onBeforeMount,
	onMounted,
	onBeforeUnmount,
	ref,
	watch,
	watchEffect,
	nextTick,
	computed,
	CSSProperties,
	PropType,
} from 'vue';
import { loadScript } from 'vue-plugin-load-script';
import { MapConfigVo, MapObj } from './types';

// åœ°å›¾åˆå§‹åŒ–æ–¹æ³•ç±»å‹
interface BNMap {
	BFactory: {
		Load: (mapId: string, config: MapConfigVo['config'], callback: (map: any) => void) => void;
	};
}
// å¼•å…¥åœ°å›¾js
declare const BNMap: BNMap;

export default defineComponent({
	name: 'MapContainer',
	props: {
		boxId: { type: String, required: true },
		mapConfigs: { type: Array<MapConfigVo>, required: true },
		showSelect: { type: Boolean, default: false },
		left: { type: Number },
		right: { type: Number, default: 30 },
		bottom: { type: Number },
		top: { type: Number, default: 30 },
		width: { type: Number, default: 150 },
		height: { type: Number, default: 32 },
		currentMapConfig: { type: Object as PropType<MapConfigVo>, required: true },
	},
	emits: {
		initGeoBox: (_mapObj: MapObj) => true,
		mapChange: (_msg: boolean, _mapId: string) => true,
		'update:currentMapConfig': (_val: MapConfigVo) => true,
	},
	setup(props, { expose, emit }) {
		const scriptElement = ref<HTMLScriptElement | null>(null);
		const selectRef = ref<InstanceType<typeof ElSelect> | null>(null);

		const mapObj = ref<any>(null);
		const bnmap = ref<any>(null);
		const draw = ref<any>(null);
		const edit = ref<any>(null);
		const playback = ref<any>(null);
		const control = ref<any>(null);

		const selectMap = ref<string>(props.currentMapConfig.id);

		const updateMapConfig = (val: MapConfigVo) => {
			emit('update:currentMapConfig', val);
		};

		const handleMapChange = (id: string) => {
			updateMapConfig(props.mapConfigs.find((item: MapConfigVo) => item.id === id) as MapConfigVo);
		};

		const styleObj = computed(
			(): CSSProperties => ({
				left: `${props.left}px`,
				top: `${props.top}px`,
				right: `${props.right}px`,
				bottom: `${props.bottom}px`,
				width: `${props.width}px`,
				height: `${props.height}px`,
			}),
		);

		// é‡ç½®
		const reset = () => {
			// æ¸…ç©ºåœ°å›¾
			mapObj.value = null;
			bnmap.value = null;
			draw.value = null;
			edit.value = null;
			playback.value = null;

			// æ¸…ç©ºå®¹å™¨ï¼Œé¿å…é‡å¤æ¸²æŸ“
			const container = document.getElementById(props.boxId);
			if (container) container.innerHTML = '';
		};

		// è·å–é€‰æ‹©æ¡†å…ƒç´ 
		const getSelect = async () => {
			await nextTick();
			if (selectRef.value) {
				const wrapper = selectRef.value.$el.querySelector('.el-select__wrapper') as HTMLElement;
				if (wrapper) {
					wrapper.style.height = `${props.height}px`;
				}
			}
		};

		// é‡ç½®åœ°å›¾çŠ¶æ€æ–¹æ³•
		const resetMapState = () => {
			if (!mapObj.value) {
				console.warn('åœ°å›¾å¯¹è±¡æœªåˆå§‹åŒ–ï¼Œæ— æ³•é‡ç½®åœ°å›¾çŠ¶æ€');
				return;
			}

			if (!props.currentMapConfig || !props.currentMapConfig.config) {
				console.warn('åœ°å›¾é…ç½®æœªåˆå§‹åŒ–ï¼Œæ— æ³•é‡ç½®åœ°å›¾çŠ¶æ€');
				return;
			}
			const { zoom, center, bearing, boxZoom, bounds } = props.currentMapConfig.config;

			try {
				// é‡ç½®zoom
				if (zoom !== undefined) {
					mapObj.value.setZoom(zoom);
				}

				// é‡ç½®center
				if (center) {
					mapObj.value.setCenter(center);
				}

				// é‡ç½®bearing
				if (bearing !== undefined) {
					mapObj.value.setBearing(bearing);
				}

				// é‡ç½®boxZoom
				if (boxZoom !== undefined) {
					if (boxZoom) {
						mapObj.value.boxZoom.enable();
					} else {
						mapObj.value.boxZoom.disable();
					}
				}

				// é‡ç½®bounds
				if (bounds) {
					mapObj.value.fitBounds(bounds, { padding: 50, duration: 1000 });
				}

				console.log('åœ°å›¾çŠ¶æ€é‡ç½®æˆåŠŸ');
			} catch (error) {
				console.error('é‡ç½®åœ°å›¾çŠ¶æ€æ—¶å‘ç”Ÿé”™è¯¯:', error);
			}
		};

		// å°è£…åˆå§‹åŒ–åœ°å›¾
		const initMap = async () => {
			if (scriptElement.value) {
				// å…ˆåˆ é™¤
				scriptElement.value.remove();
			}
			// åŠ è½½åœ°å›¾ js
			scriptElement.value = await loadScript(props.currentMapConfig.config.apiUrl);

			reset();

			// åˆå§‹åŒ–
			BNMap.BFactory.Load(
				props.currentMapConfig.config.mapId,
				{
					container: props.boxId,
					...props.currentMapConfig.config,
				},
				(map: any) => {
					mapObj.value = map;
					bnmap.value = map._innerMap;

					let mapInstance = {
						mapObj: mapObj.value,
						bnmap: bnmap.value,
						BNMap: BNMap,
					};
					// å°†åœ°å›¾å¯¹è±¡èµ‹å€¼ç»™geoBoxå·¥å…·æ–‡ä»¶
					emit('initGeoBox', mapInstance);
				},
			);
		};

		// åˆå§‹åŠ è½½
		onBeforeMount(() => {
			initMap();
		});

		onMounted(() => {
			getSelect();
		});

		onBeforeUnmount(() => {
			reset();
		});

		// ç›‘å¬åˆ‡æ¢
		watch(selectMap, async () => {
			emit('mapChange', true, props.currentMapConfig.id);
			reset();
			await nextTick();
			await initMap();
		});

		watchEffect(async () => {
			if (props.height) {
				getSelect();
			}
		});

		expose({
			mapObj,
			bnmap,
			draw,
			edit,
			playback,
			resetMapState,
			control,
		});

		return () =>
			h(
				'div',
				{
					style: {
						width: '100%',
						height: '100%',
						position: 'absolute',
						display: 'flex',
					},
				},
				[
					// åœ°å›¾å®¹å™¨
					h('div', {
						id: props.boxId,
						style: {
							width: '100%',
							height: '100%',
							background: props.currentMapConfig.background,
						},
					}),
					// ä¸‹æ‹‰æ¡†
					props.showSelect
						? h(
								'div',
								{
									style: {
										position: 'absolute',
										zIndex: 999,
										...styleObj.value,
									},
								},
								[
									h(
										ElSelect,
										{
											ref: selectRef,
											modelValue: selectMap.value,
											placeholder: 'è¯·é€‰æ‹©åœ°å›¾',
											'onUpdate:modelValue': (val: string) => {
												selectMap.value = val;
											},
											onChange: handleMapChange,
											style: { width: '100%', height: 'auto' },
										},
										() =>
											props.mapConfigs.map((item: MapConfigVo) =>
												h(ElOption, { key: item.id, label: item.name, value: item.id }),
											),
									),
								],
							)
						: null,
				],
			);
	},
});
```

:::

```vue
<MapContainer
	v-if="mapConfigs && mapConfigs.length > 0"
	box-id="Map"
	:show-select="true"
	:map-configs="mapConfigs"
	v-model:currentMapConfig="currentMapConfig"
	:right="30"
	:top="30"
	:width="150"
	:height="32"
	@map-change="mapChange"
	@init-geo-box="initGeoBox"
>
</MapContainer>
```

> é¡¹ç›®åœ°å€ï¼š[GitHub](https://github.com/359Steve/bjbn-map.git)
